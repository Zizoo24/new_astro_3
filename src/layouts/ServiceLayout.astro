---
import BaseLayout from './BaseLayout.astro';
import BreadcrumbComponent from '../components/Breadcrumb.astro';
import TrustStrip from '../components/TrustStrip.astro';
import ProcessSteps from '../components/ProcessSteps.astro';
import BenefitCards from '../components/BenefitCards.astro';
import AccordionSection from '../components/AccordionSection.astro';

interface SnapshotItem {
  icon: string;
  bold: string;
  text: string;
}

interface BreadcrumbItem {
  name: string;
  url: string;
}

interface FAQ {
  question: string;
  answer: string;
}

interface ProcessStep {
  number?: number;
  title: string;
  text: string;
  icon?: string;
}

interface BenefitCard {
  icon: string;
  title: string;
  text: string;
}

interface AccordionItem {
  heading: string;
  body: string;
}

interface AccordionGroup {
  title: string;
  id?: string;
  items: AccordionItem[];
}

interface Props {
  title: string;
  description: string;
  canonical?: string;
  keywords?: string;
  heroTitle: string;
  heroSubtitle?: string;
  heroIntro: string;
  heroImage?: string;
  /** Pre-title badge/eyebrow text (e.g., "CERTIFIED MOJ TRANSLATION") */
  heroBadge?: string;
  /** Show scroll indicator at bottom of hero */
  showScrollIndicator?: boolean;
  /** Show star rating near CTA */
  showRating?: boolean;
  /** Under-CTA note text (e.g., "Ready in 2-3 business days") */
  ctaNote?: string;
  snapshot: SnapshotItem[];
  breadcrumbs: BreadcrumbItem[];
  faqs?: FAQ[];
  serviceType?: string;
  trustStrip?: string[];
  processSteps?: ProcessStep[];
  processTitle?: string;
  benefitCards?: BenefitCard[];
  accordionSections?: AccordionGroup[];
}

const {
  title,
  description,
  canonical,
  keywords = '',
  heroTitle,
  heroSubtitle = '',
  heroIntro,
  heroImage = '',
  heroBadge = '',
  showScrollIndicator = true,
  showRating = true,
  ctaNote = '',
  snapshot,
  breadcrumbs,
  faqs = [],
  serviceType = 'Document Translation',
  trustStrip,
  processSteps,
  processTitle = 'How it works',
  benefitCards,
  accordionSections = []
} = Astro.props;

// Use Astro.site from config for consistent URL handling
const siteUrl = Astro.site?.origin || 'https://onlinetranslation.ae';

const serviceSchema = {
  "@context": "https://schema.org",
  "@type": "Service",
  "name": heroTitle,
  "description": description,
  "provider": {
    "@type": "LocalBusiness",
    "@id": `${siteUrl}/#organization`,
    "name": "OnlineTranslation.ae"
  },
  "areaServed": [
    { "@type": "City", "name": "Dubai" },
    { "@type": "City", "name": "Abu Dhabi" },
    { "@type": "City", "name": "Sharjah" },
    { "@type": "Country", "name": "UAE" }
  ],
  "serviceType": [serviceType, "Legal Translation"],
  "offers": {
    "@type": "Offer",
    "price": 150,
    "priceCurrency": "AED",
    "priceValidUntil": "2025-12-31",
    "availability": "https://schema.org/InStock",
    "validFrom": "2025-01-01",
    "url": `${siteUrl}${Astro.url.pathname}`,
    "description": "Standard service starting price. Final quote based on document review.",
    "seller": {
      "@type": "LocalBusiness",
      "@id": `${siteUrl}/#organization`
    }
  },
  "termsOfService": `${siteUrl}/terms/`,
  "serviceOutput": {
    "@type": "Thing",
    "name": "MOJ-Certified Translation",
    "description": "Ministry of Justice certified legal translation accepted by UAE courts and government entities"
  }
};

const faqSchema = faqs.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": faqs.map(faq => ({
    "@type": "Question",
    "name": faq.question,
    "acceptedAnswer": {
      "@type": "Answer",
      "text": faq.answer
    }
  }))
} : null;

// HowTo schema for process steps (rich results for "how to" queries)
const howToSchema = processSteps && processSteps.length > 0 ? {
  "@context": "https://schema.org",
  "@type": "HowTo",
  "name": `How to get ${heroTitle}`,
  "description": description,
  "step": processSteps.map((step, i) => ({
    "@type": "HowToStep",
    "position": i + 1,
    "name": step.title,
    "text": step.text
  })),
  "totalTime": "PT24H",
  "estimatedCost": {
    "@type": "MonetaryAmount",
    "currency": "AED",
    "value": "150"
  }
} : null;
---

<BaseLayout title={title} description={description} canonical={canonical}>
  <Fragment slot="head">
    {keywords && <meta name="keywords" content={keywords} />}
    <script type="application/ld+json" set:html={JSON.stringify(serviceSchema)} />
    {faqSchema && <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />}
    {howToSchema && <script type="application/ld+json" set:html={JSON.stringify(howToSchema)} />}
  </Fragment>

  <!-- Breadcrumbs -->
  <BreadcrumbComponent items={breadcrumbs} theme="dark" />

  <!-- Hero Section -->
  <section class={`section section--hero bg-dark ${heroImage ? 'has-hero-image' : ''}`}>
    {heroImage && (
      <img src={heroImage} alt={`${heroTitle} service`} class="hero-bg-image" loading="eager" width="1920" height="1080" />
    )}
    {heroImage && <div class="hero-gradient-overlay"></div>}
    <div class="container">
      <div class="row">
        <div class="col col--8">
          {/* Pre-title badge */}
          {heroBadge && <span class="hero-badge">{heroBadge}</span>}

          <h1 class="hero-title">{heroTitle}</h1>
          {heroSubtitle && <h2 class="hero-subtitle-accent">{heroSubtitle}</h2>}

          {/* Micro-divider for visual separation */}
          <div class="hero-divider" aria-hidden="true"></div>

          <div class="hero-intro" set:html={heroIntro} />

          <div class="service-snapshot">
            {snapshot.map(item => (
              <div class="snapshot-item">
                <i class={`fas fa-${item.icon}`}></i>
                <span><strong>{item.bold}</strong> {item.text}</span>
              </div>
            ))}
          </div>

          <div class="hero-cta-group">
            <a href="https://wa.me/971508620217" class="btn btn--primary btn--lg">
              <i class="fab fa-whatsapp"></i>
              Send Your Document
            </a>
            {/* Inline star rating */}
            {showRating && (
              <span class="hero-rating">
                <span class="stars" aria-label="5 out of 5 stars">★★★★★</span>
                <span class="rating-text">5.0 on Google</span>
              </span>
            )}
          </div>

          {/* Under-CTA note */}
          {ctaNote ? (
            <span class="hero-cta-note">
              <i class="fas fa-check-circle"></i> {ctaNote}
            </span>
          ) : (
            <span class="hero-cta-note">
              <i class="fas fa-check-circle"></i> Free quote within 15 minutes
            </span>
          )}
        </div>
      </div>
    </div>

    {/* Scroll indicator - clickable, auto-hides, mobile swipe variant */}
    {showScrollIndicator && (
      <div class="hero-scroll-indicator" role="button" tabindex="0" aria-label="Scroll to content">
        <span class="scroll-text-desktop">Scroll</span>
        <span class="scroll-text-mobile">Swipe</span>
        {/* Desktop: Mouse icon */}
        <div class="scroll-mouse">
          <div class="scroll-wheel"></div>
        </div>
        {/* Mobile: Swipe arrow */}
        <div class="scroll-swipe">
          <span class="scroll-swipe-arrow">↑</span>
        </div>
      </div>
    )}
  </section>

  <!-- Trust Strip (Optional) -->
  {trustStrip && trustStrip.length > 0 && (
    <TrustStrip items={trustStrip} />
  )}

  <!-- Process Steps (Optional) -->
  {processSteps && processSteps.length > 0 && (
    <ProcessSteps title={processTitle} steps={processSteps} />
  )}

  <!-- Benefit Cards (Optional) -->
  {benefitCards && benefitCards.length > 0 && (
    <BenefitCards benefits={benefitCards} />
  )}

  <!-- Accordion Sections (Optional) -->
  {accordionSections.map(section => (
    <AccordionSection 
      title={section.title} 
      items={section.items} 
      id={section.id}
    />
  ))}

  <!-- Main Content Slot -->
  <slot />

  <!-- FAQ Section -->
  {faqs.length > 0 && (
    <section class="section bg-light">
      <div class="container">
        <h2>Frequently Asked Questions</h2>
        <div class="faq-list">
          {faqs.map((faq, index) => (
            <details class="faq-item" open={index === 0}>
              <summary class="faq-question">{faq.question}</summary>
              <div class="faq-answer">
                <p>{faq.answer}</p>
              </div>
            </details>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- CTA Section -->
  <section class="section bg-dark">
    <div class="container text-center">
      <h2>Ready to Get Started?</h2>
      <p style="max-width: 600px; margin: 0 auto 2rem;">Send your document via WhatsApp for a free assessment. We will confirm requirements and provide a quote within 15 minutes during working hours.</p>
      <a href="https://wa.me/971508620217" class="btn btn--primary btn--lg">
        <i class="fab fa-whatsapp"></i>
        Start on WhatsApp
      </a>
    </div>
  </section>

</BaseLayout>

<style>
  .hero-title {
    font-family: var(--font-primary);
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 800;
    line-height: 1.1;
    letter-spacing: 0.08em;
    margin: 0 0 0.5rem;
    text-transform: uppercase;
  }
  
  .hero-subtitle-accent {
    font-family: var(--font-primary);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 800;
    color: var(--accent-color, #FF1654);
    margin: 0 0 1.5rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  
  /* .hero-intro styles moved to /styles/hero-intro-optimized.css */

  .hero-cta-group {
    margin-top: 2rem;
  }
  
  .text-center {
    text-align: center;
  }
  
  .faq-list {
    max-width: 800px;
  }
  
  .faq-item {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 1rem 0;
  }
  
  .faq-question {
    font-weight: 600;
    font-size: 1.05rem;
    cursor: pointer;
    list-style: none;
    padding-right: 2rem;
    position: relative;
  }
  
  .faq-question::after {
    content: '+';
    position: absolute;
    right: 0;
    top: 0;
    font-size: 1.5rem;
    color: var(--accent-color);
  }
  
  .faq-item[open] .faq-question::after {
    content: '−';
  }
  
  .faq-answer {
    padding-top: 1rem;
  }
  
  .faq-answer p {
    margin: 0;
    line-height: 1.7;
    color: var(--text-muted);
  }
  
  @media (max-width: 768px) {
    .hero-title {
      font-size: 1.75rem;
    }
    
    .hero-subtitle-accent {
      font-size: 1.25rem;
    }
  }
</style>
