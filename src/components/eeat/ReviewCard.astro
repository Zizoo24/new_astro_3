---
/**
 * ReviewCard.astro
 * Enhanced testimonial display with outcome tags and verification indicators
 */
interface Props {
  quote: string;
  name: string;
  role?: string;
  date?: string;
  rating?: number;
  service?: string;
  outcome?: string;
  verified?: boolean;
  source?: 'google' | 'facebook' | 'direct';
  reviewCount?: number;
}

const {
  quote,
  name,
  role = 'Verified Client',
  date,
  rating = 5,
  service,
  outcome,
  verified = true,
  source = 'google',
  reviewCount
} = Astro.props;

const sourceIcons: Record<string, string> = {
  google: 'üîç',
  facebook: 'üìò',
  direct: '‚úâÔ∏è'
};

const sourceLabels: Record<string, string> = {
  google: 'Google Review',
  facebook: 'Facebook Review',
  direct: 'Direct Feedback'
};

// Format date if provided
const formattedDate = date ? new Date(date).toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) : null;
---

<article class="review-card" itemscope itemtype="https://schema.org/Review">
  <div class="review-header">
    <div class="review-rating" itemprop="reviewRating" itemscope itemtype="https://schema.org/Rating">
      {Array.from({ length: 5 }).map((_, i) => (
        <span class={`star ${i < rating ? 'filled' : ''}`}>‚òÖ</span>
      ))}
      <meta itemprop="ratingValue" content={String(rating)} />
      <meta itemprop="bestRating" content="5" />
    </div>
    {verified && (
      <span class="verified-badge">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        Verified
      </span>
    )}
  </div>

  <blockquote class="review-quote" itemprop="reviewBody">
    "{quote}"
  </blockquote>

  {(service || outcome) && (
    <div class="review-tags">
      {service && (
        <span class="tag service-tag">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
          {service}
        </span>
      )}
      {outcome && (
        <span class="tag outcome-tag">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 11 12 14 22 4"/>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
          </svg>
          {outcome}
        </span>
      )}
    </div>
  )}

  <footer class="review-footer">
    <div class="review-author" itemprop="author" itemscope itemtype="https://schema.org/Person">
      <div class="author-avatar">
        {name.charAt(0).toUpperCase()}
      </div>
      <div class="author-info">
        <span class="author-name" itemprop="name">{name}</span>
        <span class="author-role">
          {role}
          {reviewCount && <span class="review-count"> ¬∑ {reviewCount} reviews</span>}
        </span>
      </div>
    </div>
    <div class="review-meta">
      <span class="review-source" title={sourceLabels[source]}>
        {sourceIcons[source]}
      </span>
      {formattedDate && (
        <time class="review-date" itemprop="datePublished" datetime={date}>
          {formattedDate}
        </time>
      )}
    </div>
  </footer>
</article>

<style>
  .review-card {
    background: #ffffff;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
    display: flex;
    flex-direction: column;
    gap: 1rem;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .review-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
  }

  .review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .review-rating {
    display: flex;
    gap: 0.1rem;
  }

  .star {
    font-size: 1.1rem;
    color: #d1d5db;
  }

  .star.filled {
    color: #fbbf24;
  }

  .verified-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #10b981;
  }

  .review-quote {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--text-dark, #1a1a1a);
    margin: 0;
    font-style: italic;
  }

  .review-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.35rem 0.75rem;
    border-radius: 1rem;
  }

  .service-tag {
    background: rgba(14, 43, 72, 0.1);
    color: var(--primary-navy, #0E2B48);
  }

  .outcome-tag {
    background: rgba(16, 185, 129, 0.1);
    color: #059669;
  }

  .review-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.06);
  }

  .review-author {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .author-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary-navy, #0E2B48) 0%, #1a3a5c 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1rem;
  }

  .author-info {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
  }

  .author-name {
    font-weight: 600;
    color: var(--primary-navy, #0E2B48);
    font-size: 0.95rem;
  }

  .author-role {
    font-size: 0.8rem;
    color: var(--text-muted, #5a6a7a);
  }

  .review-count {
    color: var(--text-muted, #5a6a7a);
  }

  .review-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-muted, #5a6a7a);
  }

  .review-source {
    font-size: 1rem;
  }

  .review-date {
    color: var(--text-muted, #5a6a7a);
  }

  /* Dark mode */
  :global(body.theme-dark) .review-card {
    background: #21262d;
  }

  :global(body.theme-dark) .review-quote {
    color: #e6edf3;
  }

  :global(body.theme-dark) .author-name {
    color: #f0f6fc;
  }

  :global(body.theme-dark) .author-role,
  :global(body.theme-dark) .review-date {
    color: #8b949e;
  }

  :global(body.theme-dark) .review-footer {
    border-color: rgba(255, 255, 255, 0.1);
  }

  :global(body.theme-dark) .service-tag {
    background: rgba(255, 255, 255, 0.1);
    color: #7dd3fc;
  }

  :global(body.theme-dark) .outcome-tag {
    background: rgba(16, 185, 129, 0.2);
    color: #34d399;
  }
</style>
