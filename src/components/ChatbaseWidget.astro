---
/**
 * Chatbase Chat Widget - Desktop Only, Bottom Left
 *
 * Features:
 * - Only loads on desktop (â‰¥1024px viewport)
 * - Positioned in bottom-left corner
 * - Includes resize listener for users who resize browser window
 * - Lazy loads script on window load for performance
 */
---

<!-- Chatbase Widget - Desktop Only, Bottom Left -->
<script is:inline>
(function() {
  var DESKTOP_BREAKPOINT = 1024;
  var scriptLoaded = false;

  function loadChatbase() {
    if (scriptLoaded) return;
    scriptLoaded = true;

    // Initialize Chatbase queue
    if (!window.chatbase || window.chatbase("getState") !== "initialized") {
      window.chatbase = function() {
        if (!window.chatbase.q) {
          window.chatbase.q = [];
        }
        window.chatbase.q.push(arguments);
      };
      window.chatbase = new Proxy(window.chatbase, {
        get: function(target, prop) {
          if (prop === "q") return target.q;
          return function() {
            var args = Array.prototype.slice.call(arguments);
            return target.apply(null, [prop].concat(args));
          };
        }
      });
    }

    // Load the Chatbase script
    var script = document.createElement("script");
    script.src = "https://www.chatbase.co/embed.min.js";
    script.id = "XHyFbKkbLOseA1xEcMAm6";
    script.domain = "www.chatbase.co";
    script.defer = true;
    document.body.appendChild(script);
  }

  function checkAndLoad() {
    if (window.innerWidth >= DESKTOP_BREAKPOINT) {
      loadChatbase();
      return true;
    }
    return false;
  }

  // Check on initial load
  if (checkAndLoad()) return;

  // If not loaded, add resize listener for users who resize browser
  var resizeHandler = function() {
    if (checkAndLoad()) {
      window.removeEventListener("resize", resizeHandler);
    }
  };
  window.addEventListener("resize", resizeHandler);
})();
</script>

<style is:global>
  /* Position Chatbase widget in bottom-left corner */
  #chatbase-bubble-button,
  #chatbase-bubble-window,
  iframe[title*="Chatbase"] {
    left: 20px !important;
    right: auto !important;
  }

  /* Hide on mobile/tablet (< 1024px) */
  @media (max-width: 1023px) {
    #chatbase-bubble-button,
    #chatbase-bubble-window,
    iframe[title*="Chatbase"] {
      display: none !important;
    }
  }
</style>
