---
/**
 * MobileShell.astro - Mobile Navigation (Sidebar, Bottom Bar, Search)
 * Uses navigation.ts as single source of truth
 * 
 * UPDATED: Dec 2024
 * - All accordions COLLAPSED by default (no auto-expand)
 * - Hub-based navigation (3-5 items per section)
 * - Works with existing sticky-mobile.css dark theme
 */
import { mobileNavHubs, searchQuickLinks, siteContact } from '../data/navigation';
---

<!-- Mobile Top Header - Only visible on mobile -->
<div class="header-mobile">
  <button type="button" class="header-icon" id="sidebarToggle" aria-label="Open menu">
    <i class="fas fa-bars"></i>
  </button>
  <a href="/" class="header-title">OnlineTranslation<span>.ae</span></a>
  <button type="button" id="mobileThemeToggle" class="header-icon" aria-label="Toggle theme">
    <i class="fas fa-moon"></i>
  </button>
</div>

<!-- Mobile Bottom Navigation -->
<div id="footer-bar" class="footer-bar">
  <button type="button" class="footer-item active-nav" id="footerMenuToggle">
    <i class="fas fa-bars"></i>
    <span>Menu</span>
  </button>
  <button type="button" class="footer-item" id="searchToggle">
    <i class="fas fa-search"></i>
    <span>Search</span>
  </button>
  <a href={siteContact.whatsapp} class="footer-item footer-whatsapp">
    <i class="fab fa-whatsapp"></i>
    <span>WhatsApp</span>
  </a>
  <a href={`tel:${siteContact.phone}`} class="footer-item">
    <i class="fas fa-phone"></i>
    <span>Call</span>
  </a>
  <a href="/contact/" class="footer-item">
    <i class="fas fa-envelope"></i>
    <span>Contact</span>
  </a>
</div>

<!-- Mobile Sidebar -->
<nav id="menu-sidebar" class="sidebar-menu" aria-label="Mobile navigation">
  <div class="sidebar-header">
    <a href="/" class="sidebar-logo">
      <img src="/assets/images/logo/brand/emblem-256.png" alt="OnlineTranslation.ae" class="sidebar-emblem" loading="lazy" width="48" height="48">
      <div class="sidebar-brand">
        <span class="sidebar-brand-name">Online<span class="brand-suffix">Translation.ae</span></span>
        <span class="sidebar-tagline">Boutique Legal Translation</span>
      </div>
    </a>
    <button class="sidebar-close" id="sidebarClose" aria-label="Close menu">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="sidebar-nav">
    <!-- Home Link -->
    <a href="/" class="sidebar-home-link">
      <i class="fas fa-home"></i> Home
    </a>
    
    <!-- Hub-Based Accordion Groups (3-5 items each) -->
    {mobileNavHubs.map((accordion) => (
      <div class="sidebar-accordion-group" data-accordion={accordion.id}>
        <button 
          class="sidebar-accordion-heading" 
          aria-expanded="false" 
          aria-controls={`accordion-${accordion.id}`}
        >
          <span class="heading-text">
            {accordion.icon && <i class={accordion.icon} style="margin-right: 8px; color: var(--accent-color);"></i>}
            {accordion.label}
          </span>
          <i class="fas fa-chevron-down accordion-chevron"></i>
        </button>
        <div class="sidebar-accordion-panel" id={`accordion-${accordion.id}`}>
          {/* Hub link first - highlighted */}
          <a href={accordion.href} class="sidebar-hub-link">
            <i class="fas fa-th-large"></i> {accordion.hubLabel || `All ${accordion.label}`}
          </a>
          {/* Key sub-links (3-4 max) */}
          {accordion.children.map((child) => (
            <a href={child.href}>
              {child.icon && <i class={child.icon} style="width: 16px; margin-right: 6px; opacity: 0.7;"></i>}
              {child.label}
            </a>
          ))}
        </div>
      </div>
    ))}
    
    <!-- Single Links -->
    <a href="/about/" class="sidebar-single-link">
      <i class="fas fa-building"></i> About & Licensing
    </a>
    <a href="/contact/" class="sidebar-single-link">
      <i class="fas fa-envelope"></i> Contact Us
    </a>
  </div>
  
  <div class="sidebar-contact">
    <a href={siteContact.whatsapp} class="sidebar-cta">
      <i class="fab fa-whatsapp"></i> WhatsApp Us
    </a>
    <a href={`tel:${siteContact.phone}`} class="sidebar-cta secondary">
      <i class="fas fa-phone"></i> {siteContact.phoneDisplay}
    </a>
  </div>
</nav>

<!-- Search Overlay -->
<div id="search-overlay" class="search-overlay">
  <div class="search-container">
    <button class="search-close" id="searchClose" aria-label="Close search">
      <i class="fas fa-times"></i>
    </button>
    <h3>Search Services</h3>
    <div class="search-box">
      <input type="text" placeholder="What are you looking for?" id="searchInput" aria-label="Search">
      <button class="search-btn" aria-label="Search"><i class="fas fa-search"></i></button>
    </div>
    <div id="searchResults" class="search-results"></div>
    <div class="quick-links">
      <span>Popular:</span>
      {searchQuickLinks.map((link) => (
        <a href={link.href}>{link.label}</a>
      ))}
    </div>
  </div>
</div>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- Back to Top Button -->
<button id="backToTop" class="back-to-top" aria-label="Back to top">
  <i class="fas fa-chevron-up"></i>
</button>

<style>
/* ============================================
   SIDEBAR CONTRAST FIX - Light & Dark Mode
   Forces white text on dark navy background
   ============================================ */

/* Sidebar always has dark background - force white text */
.sidebar-menu,
.sidebar-menu * {
  --sidebar-text: #ffffff;
  --sidebar-text-muted: rgba(255, 255, 255, 0.85);
  --sidebar-accent: #e8491d;
}

/* Accordion headings - ALWAYS white */
.sidebar-accordion-heading {
  color: #ffffff !important;
}

.sidebar-accordion-heading:hover,
.sidebar-accordion-heading:active,
.sidebar-accordion-heading.is-open {
  color: #ffffff !important;
}

.sidebar-accordion-heading .heading-text {
  color: #ffffff !important;
}

.sidebar-accordion-heading .heading-text i {
  color: #e8491d !important;
}

.sidebar-accordion-heading .accordion-chevron {
  color: rgba(255, 255, 255, 0.6) !important;
}

/* Accordion panel links - white text */
.sidebar-accordion-panel a {
  color: rgba(255, 255, 255, 0.9) !important;
}

.sidebar-accordion-panel a:hover,
.sidebar-accordion-panel a:active {
  color: #ffffff !important;
  background: rgba(255, 255, 255, 0.08) !important;
}

/* Hub link styling - coral accent */
.sidebar-hub-link {
  display: flex !important;
  align-items: center !important;
  padding: 10px 20px 10px 32px !important;
  background: rgba(255, 255, 255, 0.08) !important;
  font-weight: 600 !important;
  font-size: 0.85rem !important;
  color: #e8491d !important;
  border-left: 3px solid #e8491d !important;
  text-decoration: none !important;
}

.sidebar-hub-link:hover {
  background: rgba(255, 255, 255, 0.12) !important;
  color: #ffffff !important;
}

.sidebar-hub-link i {
  color: #e8491d !important;
  margin-right: 8px !important;
  width: 16px !important;
}

/* Home link styling - white */
.sidebar-home-link {
  display: flex !important;
  align-items: center !important;
  gap: 12px !important;
  padding: 14px 20px !important;
  color: #ffffff !important;
  font-weight: 600 !important;
  font-size: 0.9rem !important;
  text-decoration: none !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-left: 3px solid transparent !important;
}

.sidebar-home-link:hover,
.sidebar-home-link:active {
  background: rgba(255, 255, 255, 0.08) !important;
  border-left-color: #e8491d !important;
}

.sidebar-home-link i {
  width: 20px !important;
  color: #e8491d !important;
  font-size: 1rem !important;
}

/* Single links (About, Contact) - white */
.sidebar-single-link {
  display: flex !important;
  align-items: center !important;
  gap: 12px !important;
  padding: 14px 20px !important;
  color: #ffffff !important;
  font-weight: 600 !important;
  font-size: 0.9rem !important;
  text-decoration: none !important;
  border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
  border-left: 3px solid transparent !important;
}

.sidebar-single-link:hover,
.sidebar-single-link:active {
  background: rgba(255, 255, 255, 0.08) !important;
  border-left-color: #e8491d !important;
}

.sidebar-single-link i {
  width: 20px !important;
  color: #e8491d !important;
  font-size: 1rem !important;
}

/* Sidebar brand text - always white */
.sidebar-brand-name {
  color: #ffffff !important;
}

.sidebar-brand-name .brand-suffix {
  color: #e8491d !important;
}

.sidebar-tagline {
  color: rgba(255, 255, 255, 0.8) !important;
}

/* CTA buttons in sidebar */
.sidebar-cta {
  color: #ffffff !important;
}

.sidebar-cta.secondary {
  color: #ffffff !important;
}
</style>

<script is:inline>
document.addEventListener('DOMContentLoaded', function() {
  const footerMenuToggle = document.getElementById('footerMenuToggle');
  const sidebarClose = document.getElementById('sidebarClose');
  const sidebarOverlay = document.getElementById('sidebarOverlay');
  const menuSidebar = document.getElementById('menu-sidebar');
  const searchToggle = document.getElementById('searchToggle');
  const searchClose = document.getElementById('searchClose');
  const searchOverlay = document.getElementById('search-overlay');
  const backToTop = document.getElementById('backToTop');
  const sidebarToggle = document.getElementById('sidebarToggle');
  const mobileThemeToggle = document.getElementById('mobileThemeToggle');

  // Ensure all accordions are COLLAPSED
  function closeAllAccordions() {
    document.querySelectorAll('.sidebar-accordion-panel').forEach(function(el) {
      el.classList.remove('is-open');
    });
    document.querySelectorAll('.sidebar-accordion-heading').forEach(function(el) {
      el.classList.remove('is-open');
      el.setAttribute('aria-expanded', 'false');
    });
  }
  
  function openSidebar() {
    if (menuSidebar) {
      menuSidebar.classList.add('is-open');
    }
    if (sidebarOverlay) {
      sidebarOverlay.classList.add('is-visible');
    }
    document.body.style.overflow = 'hidden';
    // ALL accordions stay COLLAPSED - no auto-expand
    closeAllAccordions();
  }

  // Mobile top header toggle
  if (sidebarToggle) {
    sidebarToggle.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      openSidebar();
    });
  }

  // Mobile theme toggle
  if (mobileThemeToggle) {
    mobileThemeToggle.addEventListener('click', function(e) {
      e.preventDefault();
      var html = document.documentElement;
      var body = document.body;
      var currentTheme = html.getAttribute('data-theme') || 'light';
      var newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      html.setAttribute('data-theme', newTheme);
      html.className = html.className.replace(/theme-\w+/, 'theme-' + newTheme);
      body.classList.remove('theme-light', 'theme-dark');
      body.classList.add('theme-' + newTheme);
      localStorage.setItem('theme', newTheme);

      var icon = mobileThemeToggle.querySelector('i');
      if (icon) {
        icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
      }
    });
  }
  
  function closeSidebar() {
    menuSidebar?.classList.remove('is-open');
    sidebarOverlay?.classList.remove('is-visible');
    document.body.style.overflow = '';
  }
  
  function openSearch() {
    searchOverlay?.classList.add('is-open');
    document.body.style.overflow = 'hidden';
    document.getElementById('searchInput')?.focus();
  }
  
  function closeSearch() {
    searchOverlay?.classList.remove('is-open');
    document.body.style.overflow = '';
  }
  
  footerMenuToggle?.addEventListener('click', function(e) {
    e.preventDefault();
    openSidebar();
  });
  
  sidebarClose?.addEventListener('click', closeSidebar);
  sidebarOverlay?.addEventListener('click', closeSidebar);
  
  searchToggle?.addEventListener('click', function(e) {
    e.preventDefault();
    openSearch();
  });
  
  searchClose?.addEventListener('click', closeSearch);
  
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeSidebar();
      closeSearch();
    }
  });
  
  // Accordion toggle - one at a time, click to expand
  const accordionHeadings = document.querySelectorAll('.sidebar-accordion-heading');
  
  function toggleAccordion(heading) {
    const group = heading.closest('.sidebar-accordion-group');
    const accordionId = group?.getAttribute('data-accordion');
    const panel = document.getElementById('accordion-' + accordionId);
    const isExpanded = heading.getAttribute('aria-expanded') === 'true';
    
    // Close all others first
    document.querySelectorAll('.sidebar-accordion-panel').forEach(function(el) {
      el.classList.remove('is-open');
    });
    accordionHeadings.forEach(function(el) {
      el.classList.remove('is-open');
      el.setAttribute('aria-expanded', 'false');
    });
    
    // Toggle current (if wasn't expanded, expand it)
    if (!isExpanded) {
      panel?.classList.add('is-open');
      heading.classList.add('is-open');
      heading.setAttribute('aria-expanded', 'true');
    }
  }
  
  accordionHeadings.forEach(function(heading) {
    heading.addEventListener('click', function(e) {
      e.preventDefault();
      toggleAccordion(heading);
    });
    
    heading.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        toggleAccordion(heading);
      }
    });
  });
  
  // Back to top
  window.addEventListener('scroll', function() {
    if (window.pageYOffset > 300) {
      backToTop?.classList.add('is-visible');
    } else {
      backToTop?.classList.remove('is-visible');
    }
  });
  
  backToTop?.addEventListener('click', function() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
});
</script>
