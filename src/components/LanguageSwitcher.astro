---
/**
 * LanguageSwitcher.astro
 * Bilingual toggle for EN/AR navigation
 * 
 * Features:
 * - Compact "En - ع" format
 * - Detects current language from URL
 * - Maps to equivalent page in other language
 * - RTL-aware styling
 */

import { getArabicUrl, getEnglishUrl } from '../data/navigation-ar';

interface Props {
  /** Current page path */
  currentPath?: string;
  /** Visual variant */
  variant?: 'pill' | 'text' | 'icon';
  /** Size variant */
  size?: 'sm' | 'md' | 'lg';
  /** For light backgrounds */
  onLight?: boolean;
}

const { 
  currentPath = Astro.url.pathname,
  variant = 'pill',
  size = 'md',
  onLight = false
} = Astro.props;

// Detect current language
const isArabic = currentPath.startsWith('/ar/') || 
                 currentPath.startsWith('/عربي/') || 
                 currentPath === '/ar' ||
                 currentPath === '/عربي';

// Get URL for the other language
const englishUrl = getEnglishUrl(currentPath);
const arabicUrl = getArabicUrl(currentPath);

// Aria labels
const enAriaLabel = isArabic ? 'Switch to English' : 'Current language: English';
const arAriaLabel = isArabic ? 'اللغة الحالية: العربية' : 'التبديل إلى العربية';
---

<div class:list={['lang-switcher', `lang-switcher--${variant}`, `lang-switcher--${size}`, { 'on-light': onLight }]}>
  {variant === 'pill' && (
    <div class="lang-pill">
      <a 
        href={englishUrl}
        class:list={['lang-option', 'lang-en', { 'is-active': !isArabic }]}
        aria-current={!isArabic ? 'page' : undefined}
        aria-label={enAriaLabel}
        hreflang="en"
      >
        En
      </a>
      <span class="lang-divider">-</span>
      <a 
        href={arabicUrl}
        class:list={['lang-option', 'lang-ar', { 'is-active': isArabic }]}
        aria-current={isArabic ? 'page' : undefined}
        aria-label={arAriaLabel}
        hreflang="ar"
      >
        ع
      </a>
    </div>
  )}

  {variant === 'text' && (
    <div class="lang-text-group">
      <a 
        href={englishUrl}
        class:list={['lang-text-link', { 'is-active': !isArabic }]}
        aria-current={!isArabic ? 'page' : undefined}
        hreflang="en"
      >
        English
      </a>
      <span class="lang-divider">|</span>
      <a 
        href={arabicUrl}
        class:list={['lang-text-link', 'lang-ar', { 'is-active': isArabic }]}
        aria-current={isArabic ? 'page' : undefined}
        hreflang="ar"
      >
        العربية
      </a>
    </div>
  )}

  {variant === 'icon' && (
    <div class="lang-icon-group">
      <i class="fas fa-globe lang-globe"></i>
      <a 
        href={englishUrl}
        class:list={['lang-icon-link', { 'is-active': !isArabic }]}
        aria-current={!isArabic ? 'page' : undefined}
        hreflang="en"
      >
        En
      </a>
      <span class="lang-divider">/</span>
      <a 
        href={arabicUrl}
        class:list={['lang-icon-link', 'lang-ar', { 'is-active': isArabic }]}
        aria-current={isArabic ? 'page' : undefined}
        hreflang="ar"
      >
        ع
      </a>
    </div>
  )}
</div>

<style>
  /* ====================================
     LANGUAGE SWITCHER - BASE
     ==================================== */
  .lang-switcher {
    display: inline-flex;
    align-items: center;
  }

  /* ====================================
     PILL VARIANT (En - ع)
     ==================================== */
  .lang-pill {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 255, 255, 0.18);
    border: 1px solid rgba(255, 255, 255, 0.25);
    padding: 8px 16px;
    border-radius: 24px;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .lang-option {
    color: rgba(255, 255, 255, 0.85);
    text-decoration: none;
    padding: 3px 8px;
    border-radius: 6px;
    transition: all 0.2s ease;
    line-height: 1;
  }

  .lang-option.lang-en {
    font-family: var(--font-secondary, 'Open Sans', sans-serif);
  }

  .lang-option.lang-ar {
    font-family: 'Noto Sans Arabic', 'Amiri', var(--font-secondary), sans-serif;
    font-size: 1rem;
    font-weight: 700;
  }

  .lang-option:hover {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.15);
  }

  .lang-option.is-active {
    color: #ffffff;
    font-weight: 700;
    background: rgba(255, 255, 255, 0.12);
  }

  .lang-divider {
    color: rgba(255, 255, 255, 0.5);
    font-weight: 400;
    user-select: none;
  }

  /* ====================================
     TEXT VARIANT (English | العربية)
     ==================================== */
  .lang-text-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .lang-text-link {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 500;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .lang-text-link:hover {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.1);
  }

  .lang-text-link.is-active {
    color: #ffffff;
    font-weight: 700;
  }

  .lang-text-link.lang-ar {
    font-family: 'Noto Sans Arabic', var(--font-secondary), sans-serif;
  }

  /* ====================================
     ICON VARIANT (Globe En/ع)
     ==================================== */
  .lang-icon-group {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 255, 255, 0.08);
    padding: 6px 12px;
    border-radius: 8px;
  }

  .lang-globe {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
  }

  .lang-icon-link {
    color: rgba(255, 255, 255, 0.65);
    text-decoration: none;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 2px 4px;
    transition: all 0.2s ease;
  }

  .lang-icon-link:hover {
    color: #ffffff;
  }

  .lang-icon-link.is-active {
    color: #ffffff;
    font-weight: 700;
  }

  .lang-icon-link.lang-ar {
    font-family: 'Noto Sans Arabic', var(--font-secondary), sans-serif;
    font-size: 0.9rem;
  }

  /* ====================================
     SIZE VARIANTS
     ==================================== */
  .lang-switcher--sm .lang-pill {
    padding: 6px 12px;
    font-size: 0.8rem;
    gap: 4px;
  }

  .lang-switcher--sm .lang-option.lang-ar {
    font-size: 0.9rem;
  }

  .lang-switcher--lg .lang-pill {
    padding: 10px 20px;
    font-size: 1rem;
    gap: 8px;
  }

  .lang-switcher--lg .lang-option.lang-ar {
    font-size: 1.15rem;
  }

  /* ====================================
     LIGHT BACKGROUND VERSION
     ==================================== */
  .lang-switcher.on-light .lang-pill {
    background: rgba(14, 43, 72, 0.08);
  }

  .lang-switcher.on-light .lang-option {
    color: rgba(14, 43, 72, 0.6);
  }

  .lang-switcher.on-light .lang-option:hover {
    color: var(--ot-navy, #0E2B48);
    background: rgba(14, 43, 72, 0.08);
  }

  .lang-switcher.on-light .lang-option.is-active {
    color: var(--ot-navy, #0E2B48);
  }

  .lang-switcher.on-light .lang-divider {
    color: rgba(14, 43, 72, 0.3);
  }

  .lang-switcher.on-light .lang-text-link,
  .lang-switcher.on-light .lang-icon-link {
    color: rgba(14, 43, 72, 0.6);
  }

  .lang-switcher.on-light .lang-text-link:hover,
  .lang-switcher.on-light .lang-icon-link:hover,
  .lang-switcher.on-light .lang-text-link.is-active,
  .lang-switcher.on-light .lang-icon-link.is-active {
    color: var(--ot-navy, #0E2B48);
  }

  .lang-switcher.on-light .lang-icon-group {
    background: rgba(14, 43, 72, 0.06);
  }

  .lang-switcher.on-light .lang-globe {
    color: rgba(14, 43, 72, 0.5);
  }

  /* ====================================
     DARK MODE
     ==================================== */
  [data-theme="dark"] .lang-pill,
  body.theme-dark .lang-pill {
    background: rgba(255, 255, 255, 0.1);
  }

  /* ====================================
     FOOTER SPECIFIC STYLES
     ==================================== */
  .footer-lang-row .lang-pill {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .footer-lang-row .lang-option.is-active {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 12px;
  }

  /* ====================================
     RESPONSIVE
     ==================================== */
  @media (max-width: 991px) {
    .lang-switcher--md .lang-pill {
      padding: 5px 12px;
      font-size: 0.8rem;
    }
  }
</style>
