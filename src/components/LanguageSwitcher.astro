---
/**
 * LanguageSwitcher.astro
 * Bilingual toggle for EN/AR navigation
 *
 * Features:
 * - Globe variant: compact globe icon for navbar (matches action buttons)
 * - Pill variant: compact "En - ع" format
 * - Text variant: full "English | العربية" labels
 * - Icon variant: globe icon with En/ع labels
 * - Detects current language from URL
 * - Maps to equivalent page in other language
 * - RTL-aware styling
 *
 * NOTE: All language links use data-astro-reload to force full page reload.
 * This is required because EN/AR layouts load different CSS files (rtl.css,
 * ar-ui-fixes.css vs en-ui-fixes.css) and the deferred CSS loading pattern
 * (media="print" onload) doesn't re-execute during View Transitions.
 */

import { getArabicUrl, getEnglishUrl } from '../data/navigation-ar';

interface Props {
  /** Current page path */
  currentPath?: string;
  /** Visual variant */
  variant?: 'pill' | 'text' | 'icon' | 'globe';
  /** Size variant */
  size?: 'sm' | 'md' | 'lg';
  /** For light backgrounds */
  onLight?: boolean;
}

const { 
  currentPath = Astro.url.pathname,
  variant = 'pill',
  size = 'md',
  onLight = false
} = Astro.props;

// Detect current language
const isArabic = currentPath.startsWith('/ar/') || 
                 currentPath.startsWith('/عربي/') || 
                 currentPath === '/ar' ||
                 currentPath === '/عربي';

// Get URL for the other language
const englishUrl = getEnglishUrl(currentPath);
const arabicUrl = getArabicUrl(currentPath);

// Toggle URL (switch to the OTHER language)
const toggleUrl = isArabic ? englishUrl : arabicUrl;
const toggleLabel = isArabic ? 'English' : 'العربية';
const toggleAriaLabel = isArabic ? 'Switch to English' : 'التبديل إلى العربية';

// Aria labels for pill/text/icon variants
const enAriaLabel = isArabic ? 'Switch to English' : 'Current language: English';
const arAriaLabel = isArabic ? 'اللغة الحالية: العربية' : 'التبديل إلى العربية';
---

<div class:list={['lang-switcher', `lang-switcher--${variant}`, `lang-switcher--${size}`, { 'on-light': onLight }]}>
  
  {/* GLOBE VARIANT - Single icon button for navbar */}
  {variant === 'globe' && (
    <a
      href={toggleUrl}
      class="lang-globe-btn"
      aria-label={toggleAriaLabel}
      title={toggleLabel}
      hreflang={isArabic ? 'en' : 'ar'}
      data-astro-reload
    >
      <i class="fas fa-globe" aria-hidden="true"></i>
      <span class="lang-globe-label">{isArabic ? 'En' : 'ع'}</span>
    </a>
  )}

  {variant === 'pill' && (
    <div class="lang-pill">
      <a
        href={englishUrl}
        class:list={['lang-option', 'lang-en', { 'is-active': !isArabic }]}
        aria-current={!isArabic ? 'page' : undefined}
        aria-label={enAriaLabel}
        hreflang="en"
        data-astro-reload
      >
        En
      </a>
      <span class="lang-divider">-</span>
      <a
        href={arabicUrl}
        class:list={['lang-option', 'lang-ar', { 'is-active': isArabic }]}
        aria-current={isArabic ? 'page' : undefined}
        aria-label={arAriaLabel}
        hreflang="ar"
        data-astro-reload
      >
        ع
      </a>
    </div>
  )}

  {variant === 'text' && (
    <div class="lang-text-group">
      <a
        href={englishUrl}
        class:list={['lang-text-link', { 'is-active': !isArabic }]}
        aria-current={!isArabic ? 'page' : undefined}
        hreflang="en"
        data-astro-reload
      >
        English
      </a>
      <span class="lang-divider">|</span>
      <a
        href={arabicUrl}
        class:list={['lang-text-link', 'lang-ar', { 'is-active': isArabic }]}
        aria-current={isArabic ? 'page' : undefined}
        hreflang="ar"
        data-astro-reload
      >
        العربية
      </a>
    </div>
  )}

  {variant === 'icon' && (
    <div class="lang-icon-group">
      <i class="fas fa-globe lang-globe"></i>
      <a
        href={englishUrl}
        class:list={['lang-icon-link', { 'is-active': !isArabic }]}
        aria-current={!isArabic ? 'page' : undefined}
        hreflang="en"
        data-astro-reload
      >
        En
      </a>
      <span class="lang-divider">/</span>
      <a
        href={arabicUrl}
        class:list={['lang-icon-link', 'lang-ar', { 'is-active': isArabic }]}
        aria-current={isArabic ? 'page' : undefined}
        hreflang="ar"
        data-astro-reload
      >
        ع
      </a>
    </div>
  )}
</div>

<style>
  /* ====================================
     LANGUAGE SWITCHER - BASE
     ==================================== */
  .lang-switcher {
    display: inline-flex;
    align-items: center;
  }

  /* ====================================
     GLOBE VARIANT - Compact navbar button
     Matches header-action-btn styling
     ==================================== */
  .lang-globe-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.1);
    border: 0;
    border-radius: 50%;
    color: #ffffff;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    position: relative;
    z-index: 100;
  }

  .lang-globe-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: #ffffff;
  }

  .lang-globe-btn:active {
    transform: scale(0.95);
  }

  .lang-globe-btn i {
    font-size: 1rem;
    color: #ffffff !important;
    pointer-events: none;
  }

  /* Small label badge on the globe icon */
  .lang-globe-label {
    position: absolute;
    bottom: 2px;
    right: 2px;
    font-size: 8px;
    font-weight: 800;
    line-height: 1;
    color: #ffffff;
    background: var(--ot-coral, #FF1654);
    border-radius: 4px;
    padding: 1px 3px;
    pointer-events: none;
    font-family: var(--font-secondary, 'Open Sans', sans-serif);
  }

  /* Arabic label uses Arabic font */
  :global(html:not([lang="ar"])) .lang-globe-label {
    font-family: 'Noto Sans Arabic', var(--font-secondary), sans-serif;
    font-size: 9px;
    font-weight: 700;
  }

  /* Scrolled state - compact */
  :global(.site-header.scrolled) .lang-globe-btn {
    width: 32px;
    height: 32px;
  }

  :global(.site-header.scrolled) .lang-globe-btn i {
    font-size: 0.9rem;
  }

  :global(.site-header.scrolled) .lang-globe-label {
    font-size: 7px;
    bottom: 1px;
    right: 1px;
  }

  /* Light background version */
  .lang-switcher.on-light .lang-globe-btn {
    background: rgba(14, 43, 72, 0.08);
    color: var(--ot-navy, #0E2B48);
  }

  .lang-switcher.on-light .lang-globe-btn:hover {
    background: rgba(14, 43, 72, 0.15);
  }

  .lang-switcher.on-light .lang-globe-btn i {
    color: var(--ot-navy, #0E2B48) !important;
  }

  /* ====================================
     PILL VARIANT (En - ع)
     ==================================== */
  .lang-pill {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 255, 255, 0.18);
    border: 1px solid rgba(255, 255, 255, 0.25);
    padding: 8px 16px;
    border-radius: 24px;
    font-size: 0.9rem;
    font-weight: 600;
  }

  .lang-option {
    color: rgba(255, 255, 255, 0.85);
    text-decoration: none;
    padding: 3px 8px;
    border-radius: 6px;
    transition: all 0.2s ease;
    line-height: 1;
  }

  .lang-option.lang-en {
    font-family: var(--font-secondary, 'Open Sans', sans-serif);
  }

  .lang-option.lang-ar {
    font-family: 'Noto Sans Arabic', 'Amiri', var(--font-secondary), sans-serif;
    font-size: 1rem;
    font-weight: 700;
  }

  .lang-option:hover {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.15);
  }

  .lang-option.is-active {
    color: #ffffff;
    font-weight: 700;
    background: rgba(255, 255, 255, 0.12);
  }

  .lang-divider {
    color: rgba(255, 255, 255, 0.5);
    font-weight: 400;
    user-select: none;
  }

  /* ====================================
     TEXT VARIANT (English | العربية)
     ==================================== */
  .lang-text-group {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .lang-text-link {
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 500;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .lang-text-link:hover {
    color: #ffffff;
    background: rgba(255, 255, 255, 0.1);
  }

  .lang-text-link.is-active {
    color: #ffffff;
    font-weight: 700;
  }

  .lang-text-link.lang-ar {
    font-family: 'Noto Sans Arabic', var(--font-secondary), sans-serif;
  }

  /* ====================================
     ICON VARIANT (Globe En/ع)
     ==================================== */
  .lang-icon-group {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(255, 255, 255, 0.08);
    padding: 6px 12px;
    border-radius: 8px;
  }

  .lang-globe {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
  }

  .lang-icon-link {
    color: rgba(255, 255, 255, 0.65);
    text-decoration: none;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 2px 4px;
    transition: all 0.2s ease;
  }

  .lang-icon-link:hover {
    color: #ffffff;
  }

  .lang-icon-link.is-active {
    color: #ffffff;
    font-weight: 700;
  }

  .lang-icon-link.lang-ar {
    font-family: 'Noto Sans Arabic', var(--font-secondary), sans-serif;
    font-size: 0.9rem;
  }

  /* ====================================
     SIZE VARIANTS
     ==================================== */
  .lang-switcher--sm .lang-pill {
    padding: 6px 12px;
    font-size: 0.8rem;
    gap: 4px;
  }

  .lang-switcher--sm .lang-option.lang-ar {
    font-size: 0.9rem;
  }

  .lang-switcher--lg .lang-pill {
    padding: 10px 20px;
    font-size: 1rem;
    gap: 8px;
  }

  .lang-switcher--lg .lang-option.lang-ar {
    font-size: 1.15rem;
  }

  /* ====================================
     LIGHT BACKGROUND VERSION
     ==================================== */
  .lang-switcher.on-light .lang-pill {
    background: rgba(14, 43, 72, 0.08);
  }

  .lang-switcher.on-light .lang-option {
    color: rgba(14, 43, 72, 0.6);
  }

  .lang-switcher.on-light .lang-option:hover {
    color: var(--ot-navy, #0E2B48);
    background: rgba(14, 43, 72, 0.08);
  }

  .lang-switcher.on-light .lang-option.is-active {
    color: var(--ot-navy, #0E2B48);
  }

  .lang-switcher.on-light .lang-divider {
    color: rgba(14, 43, 72, 0.3);
  }

  .lang-switcher.on-light .lang-text-link,
  .lang-switcher.on-light .lang-icon-link {
    color: rgba(14, 43, 72, 0.6);
  }

  .lang-switcher.on-light .lang-text-link:hover,
  .lang-switcher.on-light .lang-icon-link:hover,
  .lang-switcher.on-light .lang-text-link.is-active,
  .lang-switcher.on-light .lang-icon-link.is-active {
    color: var(--ot-navy, #0E2B48);
  }

  .lang-switcher.on-light .lang-icon-group {
    background: rgba(14, 43, 72, 0.06);
  }

  .lang-switcher.on-light .lang-globe {
    color: rgba(14, 43, 72, 0.5);
  }

  /* ====================================
     DARK MODE
     ==================================== */
  [data-theme="dark"] .lang-pill,
  body.theme-dark .lang-pill {
    background: rgba(255, 255, 255, 0.1);
  }

  /* ====================================
     FOOTER SPECIFIC STYLES
     ==================================== */
  .footer-lang-row .lang-pill {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .footer-lang-row .lang-option.is-active {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 12px;
  }

  /* ====================================
     RESPONSIVE
     ==================================== */
  @media (max-width: 991px) {
    .lang-switcher--md .lang-pill {
      padding: 5px 12px;
      font-size: 0.8rem;
    }
  }
</style>
